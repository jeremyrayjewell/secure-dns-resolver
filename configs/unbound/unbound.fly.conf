# Fly.io deployment config (private-by-default)
#
# IMPORTANT:
# - This is intended for use over Fly private networking (6PN) / WireGuard.
# - It uses unprivileged ports: plaintext DNS on 8053 and DoT on 8853.
# - It allows only Fly's private IPv6 range by default.
#
# If you later decide to expose this publicly, revisit access control carefully.

server:
  module-config: "validator iterator"

  # Container runs as an unprivileged user; do not attempt setuid/setgid.
  username: ""

  do-ip4: yes
  do-ip6: yes

  # Root DNSSEC trust anchor (public). Avoids requiring unbound-anchor at runtime.
  trust-anchor: ". DS 20326 8 2 E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D"
  root-hints: "var/root.hints"

  # Plain DNS (UDP/TCP) on unprivileged port.
  port: 8053
  # Runtime-provided listen interfaces. On Fly, this binds UDP to the numeric
  # address behind `fly-global-services` (Unbound requires numeric IPs).
  include: "/data/interfaces.conf"

  # DNS-over-TLS (DoT) on unprivileged port.
  interface: 0.0.0.0@8853
  interface: ::0@8853
  tls-port: 8853

  tls-service-key: "/data/server.key"
  tls-service-pem: "/data/server.pem"

  # Private-by-default ACLs.
  access-control: 127.0.0.0/8 allow
  access-control: ::1 allow

  # Additional allow rules are injected at runtime (e.g., Fly 6PN or local dev).
  include: "/data/access-control.conf"

  access-control: 0.0.0.0/0 refuse
  access-control: ::0/0 refuse

  hide-identity: yes
  hide-version: yes
  hide-trustanchor: yes

  harden-dnssec-stripped: yes
  harden-glue: yes
  harden-short-bufsize: yes
  deny-any: yes
  minimal-responses: yes
  qname-minimisation: yes

  private-address: 10.0.0.0/8
  private-address: 172.16.0.0/12
  private-address: 192.168.0.0/16
  private-address: 169.254.0.0/16
  private-address: fd00::/8
  private-address: fe80::/10

  verbosity: 1
  logfile: "var/unbound.log"

  num-threads: 1
