# Fly.io deployment config (private-by-default)
#
# IMPORTANT:
# - This is intended for use over Fly private networking (6PN) / WireGuard.
# - It does NOT expose plaintext DNS on port 53.
# - It allows only Fly's private IPv6 range by default.
#
# If you later decide to expose this publicly, revisit access control carefully.

server:
  module-config: "validator iterator"

  do-ip4: yes
  do-ip6: yes

  auto-trust-anchor-file: "var/root.key"
  root-hints: "var/root.hints"

  # DoT only (TCP/853), listen on all interfaces.
  interface: 0.0.0.0@853
  interface: ::0@853
  tls-port: 853

  tls-service-key: "/data/server.key"
  tls-service-pem: "/data/server.pem"

  # Private-by-default ACLs.
  access-control: 127.0.0.0/8 allow
  access-control: ::1 allow

  # Additional allow rules are injected at runtime (e.g., Fly 6PN or local dev).
  include: "/data/access-control.conf"

  access-control: 0.0.0.0/0 refuse
  access-control: ::0/0 refuse

  hide-identity: yes
  hide-version: yes
  hide-trustanchor: yes

  harden-dnssec-stripped: yes
  harden-glue: yes
  harden-short-bufsize: yes
  deny-any: yes
  minimal-responses: yes
  qname-minimisation: yes

  private-address: 10.0.0.0/8
  private-address: 172.16.0.0/12
  private-address: 192.168.0.0/16
  private-address: 169.254.0.0/16
  private-address: fd00::/8
  private-address: fe80::/10

  verbosity: 1
  logfile: "var/unbound.log"

  num-threads: 1
